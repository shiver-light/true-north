<view class="page">
  <!-- 顶部浮层：语言 & 卫星图 -->
  <view class="floating-tools">
    <view class="seg">
      <view class="seg-item {{lang==='zh'?'active':''}}" bindtap="switchToZh">中文</view>
      <view class="seg-item {{lang==='en'?'active':''}}" bindtap="switchToEn">EN</view>
    </view>
    <view class="toggle">
      <text class="toggle-text">{{t.satellite}}</text>
      <switch class="toggle-switch" checked="{{satellite}}" bindchange="toggleSatellite" />
    </view>
  </view>

  <!-- 地图卡片 -->
  <view class="card map-card">
    <map
      id="map"
      longitude="{{center.longitude}}"
      latitude="{{center.latitude}}"
      scale="15"
      class="map"
      markers="{{markers}}"
      polyline="{{polyline}}"
      enable-3D="false"
      show-location="true"
      enable-satellite="{{satellite}}"
      bindtap="onMapTap"
    />
    <!-- 拾取状态条 -->
    <view class="pickbar">
      <view class="seg wide">
        <button class="seg-btn {{pickTarget==='A'?'active':''}}" bindtap="startPickA">{{t.pickToA}}</button>
        <button class="seg-btn {{pickTarget==='B'?'active':''}}" bindtap="startPickB">{{t.pickToB}}</button>
        <button class="seg-btn" bindtap="stopPick" disabled="{{pickTarget==='none'}}">{{t.cancelPick}}</button>
      </view>
      <text class="pick-hint">
        {{ pickTarget==='none' ? t.pickHintIdle : (t.pickHintActive.replace('{target}', pickTarget)) }}
      </text>
    </view>
  </view>

  <!-- 动作按钮 -->
  <view class="actions">
    <view class="grid">
      <button class="btn primary" bindtap="setAFromCurrent">{{t.currentToA}}</button>
      <button class="btn primary" bindtap="setBFromCurrent">{{t.currentToB}}</button>
      <button class="btn ghost" bindtap="gotoA" disabled="{{!A}}">{{t.gotoA}}</button>
      <button class="btn ghost" bindtap="gotoB" disabled="{{!B}}">{{t.gotoB}}</button>
    </view>
    <view class="grid">
      <button class="btn danger" bindtap="clearAll" disabled="{{!A && !B}}">{{t.clearAB}}</button>
      <button class="btn success" bindtap="computeBearingAndDistance" disabled="{{!A || !B}}">{{t.compute}}</button>
    </view>
  </view>

  <!-- 信息面板 -->
  <view class="card info-card">
    <view class="row">
      <view class="k">A</view>
      <view class="v mono">{{A ? (A.latitude + ", " + A.longitude) : t.unset}}</view>
    </view>
    <view class="row">
      <view class="k">{{t.altA}}</view>
      <view class="v">{{altAStr}}</view>
    </view>

    <view class="divider"></view>

    <view class="row">
      <view class="k">B</view>
      <view class="v mono">{{B ? (B.latitude + ", " + B.longitude) : t.unset}}</view>
    </view>
    <view class="row">
      <view class="k">{{t.altB}}</view>
      <view class="v">{{altBStr}}</view>
    </view>

    <view class="divider"></view>

    <view class="row">
      <view class="k">{{t.bearingLabel}}</view>
      <view class="v strong">{{bearingStr}}</view>
    </view>
    <view class="row">
      <view class="k">{{t.distanceLabel}}</view>
      <view class="v">{{distanceStr}}</view>
    </view>
    <view class="row">
      <view class="k">{{t.altDiffLabel}}</view>
      <view class="v">{{altDiffStr}}</view>
    </view>
  </view>
</view>